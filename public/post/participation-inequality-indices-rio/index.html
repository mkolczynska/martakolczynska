<!DOCTYPE html>
<html lang="en">

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="A quick guide to working with different file formats with `rio`">
  <meta name="generator" content="Hugo 0.42.2" />

  <title>Downloading country-level indicators on participation and economic inequality 2.0 &middot; Marta Kołczyńska</title>

  
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/pure-min.css">

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/grids-responsive-old-ie-min.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/grids-responsive-min.css">
  <!--<![endif]-->

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="/css/side-menu-old-ie.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="/css/side-menu.css">
  <!--<![endif]-->

  <link rel="stylesheet" href="/css/blackburn.css">

  
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">

  
  <link href="https://fonts.googleapis.com/css?family=Raleway" rel="stylesheet" type="text/css">

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

 
  

  
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/foundation.min.css">
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/r.min.js"></script>
  
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/yaml.min.js"></script>
  
  <script>hljs.initHighlightingOnLoad();</script>
  

  <link rel="shortcut icon" href="/img/favicon.ico" type="image/x-icon" />

  
    
        <link rel="stylesheet" href="/css/circle.css">
    
  
  

</head>


<body>
<div id="layout">

  
<a href="#menu" id="menuLink" class="menu-link">
  
  <span></span>
</a>
<div id="menu">

  
  <a class="pure-menu-heading brand" href="/"><img src="/images/puzzleblacksmall.png" alt="logo" /></a>



  <div class="pure-menu">
    <ul class="pure-menu-list">
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="/"><i class='fa fa-home fa-fw'></i>Home</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="/about/"><i class='fa fa-user fa-fw'></i>About</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="/research/"><i class='fa fa-bar-chart fa-fw'></i>Research</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="/post/"><i class='fa fa-list fa-fw'></i>Posts</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="/contact/"><i class='fa fa-envelope fa-fw'></i>Contact</a>
      
        </li>
      
    </ul>
  </div>

  <div class="pure-menu social">
  <ul class="pure-menu-list">

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://twitter.com/MartaKolcz" target="_blank"><i class="fa fa-twitter-square fa-fw"></i>Twitter</a>
    </li>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://github.com/mkolczynska" target="_blank"><i class="fa fa-github-square fa-fw"></i>GitHub</a>
    </li>
    

    

    

    

    

    

    

    

    

    

    

    

    

  </ul>
</div>


  <div>
  <div class="small-print">
    <small>&copy; 2018. Marta Kołczyńska</small>
  </div>
  <div class="small-print">
    <small>Built with&nbsp;<a href="https://gohugo.io/" target="_blank">Hugo</a></small>
    <small>Theme&nbsp;<a href="https://github.com/yoshiharuyamashita/blackburn" target="_blank">Blackburn</a></small>
  </div>
</div>

</div>


  <div id="main">


<div class="header">
  <h1>Downloading country-level indicators on participation and economic inequality 2.0</h1>
  <h2>A quick guide to working with different file formats with `rio`</h2>
</div>
<div class="content">

  <div class="post-meta">

  <div>
    <i class="fa fa-calendar fa-fw"></i>
    <time>03 Feb 2019, 15:52</time>
  </div>

  

  

  
  
  
  <div>
    <i class="fa fa-tags fa-fw"></i>
    
      <a class="post-taxonomy-tag" href="/tags/r">R</a>&nbsp;&#47;
    
      <a class="post-taxonomy-tag" href="/tags/rio">rio</a>&nbsp;&#47;
    
      <a class="post-taxonomy-tag" href="/tags/tutorial">tutorial</a>&nbsp;&#47;
    
      <a class="post-taxonomy-tag" href="/tags/macro-indicators">macro indicators</a>&nbsp;&#47;
    
      <a class="post-taxonomy-tag" href="/tags/political-participation">political participation</a>&nbsp;&#47;
    
      <a class="post-taxonomy-tag" href="/tags/economic-inequality">economic inequality</a>&nbsp;&#47;
    
      <a class="post-taxonomy-tag" href="/tags/cross-national-research">cross-national research</a>&nbsp;&#47;
    
      <a class="post-taxonomy-tag" href="/tags/swiid">SWIID</a>&nbsp;&#47;
    
      <a class="post-taxonomy-tag" href="/tags/world-bank">World Bank</a>&nbsp;&#47;
    
      <a class="post-taxonomy-tag" href="/tags/freedom-house">Freedom House</a>&nbsp;&#47;
    
      <a class="post-taxonomy-tag" href="/tags/democracy-barometer">Democracy Barometer</a>&nbsp;&#47;
    
      <a class="post-taxonomy-tag" href="/tags/v-dem">V-Dem</a>&nbsp;&#47;
    
      <a class="post-taxonomy-tag" href="/tags/polyarchy">Polyarchy</a>&nbsp;&#47;
    
      <a class="post-taxonomy-tag" href="/tags/polity-iv">Polity IV</a>
    
  </div>
  
  

</div>

  <div id="TOC">
<ul>
<li><a href="#data">Data</a></li>
<li><a href="#packages">Packages</a></li>
<li><a href="#varieties-of-democracy-v-dem-dedicated-package">Varieties of Democracy (V-Dem): Dedicated package</a></li>
<li><a href="#polyarchy-semicolon-delimited-csv-file---rio">Polyarchy: Semicolon delimited CSV file <code>-&gt; rio</code></a></li>
<li><a href="#freedom-house-excel-file-with-by-year-sheets">Freedom House: Excel file with by-year sheets</a></li>
<li><a href="#polity-iv-spss-file---rio">Polity IV: SPSS file <code>-&gt; rio</code></a></li>
<li><a href="#democracy-barometer-excel-file-with-header-in-top-rows---rio">Democracy Barometer: Excel file with header in top rows <code>-&gt; rio</code></a></li>
<li><a href="#the-standardized-world-income-inequality-database-swiid-plain-csv-file---rio">The Standardized World Income Inequality Database (SWIID): Plain CSV file <code>-&gt; rio</code></a></li>
<li><a href="#world-banks-world-development-indicators-dedicated-package">World Bank’s World Development Indicators: Dedicated package</a></li>
<li><a href="#merging-all-datasets">Merging all datasets</a></li>
<li><a href="#writing-to-file">Writing to file</a></li>
</ul>
</div>

<p>Shortly after writing this <a href="https://martakolczynska.com/post/participation-inequality-indices/" target="_blank">post</a> on importing datasets in different formats (CSV, XLS, XLSX, SAV) to R, I got the following comment:</p>
<blockquote class="twitter-tweet" data-lang="en">
<p lang="en" dir="ltr">
Check out {rio}, which might simplify a lot of that import code.
</p>
— Thomas J. Leeper (<span class="citation">@thosjleeper</span>) <a href="https://twitter.com/thosjleeper/status/1092055278370111492?ref_src=twsrc%5Etfw">February 3, 2019</a>
</blockquote>
<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
<p>And simplify it did. <a href="https://github.com/leeper/rio" target="_blank"><code>rio</code></a> imports and exports data from/to different formats, and conveniently has the <code>stringsAsFactors</code> option set to <code>FALSE</code> by default. <code>rio</code> won’t make importing data entirely effort-free and there still will be surprises in the structure of the data in the files, but at least one doesn’t have to worry about delimiters in CSV files and which function for reading Excel files to use.</p>
<div id="data" class="section level3">
<h3>Data</h3>
<p>The <a href="https://martakolczynska.com/post/participation-inequality-indices/#data" target="_blank">same</a>.</p>
</div>
<div id="packages" class="section level3">
<h3>Packages</h3>
<pre class="r"><code>#devtools::install_github(&quot;xmarquez/vdem&quot;)
library(vdem) # gets V-Dem data
library(WDI) # gets data from World Bank&#39;s WDI
library(countrycode) # converts country codes
library(tidyverse) # for manipulating data
library(rio) # for reading all kinds of file types
library(readxl) # for reading xls and xlsx files
library(data.table) # fwrite to quickly write to CSV</code></pre>
</div>
<div id="varieties-of-democracy-v-dem-dedicated-package" class="section level3">
<h3>Varieties of Democracy (V-Dem): Dedicated package</h3>
<p>The same - dedicated packages are still my preferred option.</p>
<pre class="r"><code>vdem.part &lt;- extract_vdem(name_pattern = &quot;v2x_partipdem&quot;, include_uncertainty = FALSE) %&gt;%
  select(iso3 = vdem_country_text_id, year, vdem_par = v2x_partipdem)</code></pre>
</div>
<div id="polyarchy-semicolon-delimited-csv-file---rio" class="section level3">
<h3>Polyarchy: Semicolon delimited CSV file <code>-&gt; rio</code></h3>
<p><code>rio::import</code> instead of <code>read.csv</code>.</p>
<pre class="r"><code>polyarchy &lt;- import(&quot;https://www.prio.org/Global/upload/CSCW/Data/Governance/file42534_polyarchy_v2.csv&quot;) %&gt;%
  mutate(iso3 = countrycode(Abbr, &quot;cowc&quot;, &quot;iso3c&quot;)) %&gt;%
  select(iso3, year = Year, polyarch_part = Part) %&gt;%
  mutate(year = as.numeric(year),
         polyarch_part = as.numeric(polyarch_part))</code></pre>
</div>
<div id="freedom-house-excel-file-with-by-year-sheets" class="section level3">
<h3>Freedom House: Excel file with by-year sheets</h3>
<p>While the <code>rio</code> package can download data from an XLSX file without problems with a single line:</p>
<pre class="r"><code>fh &lt;- import(&quot;https://freedomhouse.org/sites/default/files/Aggregate%20Category%20and%20Subcategory%20Scores%20FIW2003-2018.xlsx&quot;, 
             sheet = 2)</code></pre>
<p>in this particular case it’s necessary to understand the structure of the whole document before deciding which elements to extract. One possibility would be to just open the file in Excel, take a look, and then loop through sheets with <code>rio</code>.</p>
<p>The other possibility is to go the old way: save the XLSX file to the temp folder, look at its structure, and extract the selected pieces.</p>
<pre class="r"><code>myurl &lt;- &quot;https://freedomhouse.org/sites/default/files/Aggregate%20Category%20and%20Subcategory%20Scores%20FIW2003-2018.xlsx&quot; # sets URL to the file to be downloaded
td = tempdir() # reads in the path to the temp directory
tmp &lt;- tempfile(tmpdir = td, fileext = &quot;.xlsx&quot;) # creates path to the temp file in the temp directory
download.file(url = myurl, destfile = tmp, mode=&quot;wb&quot;) # downloads file from URL to the temp file with set extention
excel_sheets(tmp) # reads sheet names from the downloaded file
names(read_excel(path = tmp, sheet = 2)) # reads column names from the second sheet

fh.list &lt;- list() # creates empty list to store selected parts of the 13 sheets
for (i in 1:13) {
  fh.list[[i]] &lt;- read_excel(path = tmp, 
                             sheet = i+1) %&gt;% # indexes (numbers) of columns to be extracted
    select(`Country/Territory`, fh_B_aggr = `B Aggr`) %&gt;% # selects columns
    mutate(country = gsub(&quot;[*].*$&quot;, &quot;&quot;, `Country/Territory`), # converts to iso3c codes
           year = 2018 - i + 1) # adds year column
}

fh &lt;- do.call(&quot;rbind&quot;, fh.list) %&gt;% # binds (append) rows of all elements of fh.list
  mutate(iso3 = countrycode(country, &quot;country.name&quot;, &quot;iso3c&quot;)) %&gt;%
  mutate(iso3 = ifelse(country %in% c(&quot;Kosovo&quot;, &quot;Kosovo*&quot;), &quot;XKX&quot;, iso3)) %&gt;%
  select(-country)</code></pre>
</div>
<div id="polity-iv-spss-file---rio" class="section level3">
<h3>Polity IV: SPSS file <code>-&gt; rio</code></h3>
<p><code>rio::import</code> instead of <code>haven::read_sav</code>.</p>
<pre class="r"><code>polity &lt;- import(&quot;http://www.systemicpeace.org/inscr/p4v2017.sav&quot;) %&gt;%
  mutate(iso3 = countrycode(country, &quot;country.name&quot;, &quot;iso3c&quot;)) %&gt;%
  mutate(iso3 = ifelse(country == &quot;Kosovo&quot;, &quot;XKX&quot;, iso3),
         p4_polcomp = ifelse(polcomp %in% c(-66, -77, -88), NA, polcomp)) %&gt;%
  select(iso3, year, p4_polcomp)</code></pre>
</div>
<div id="democracy-barometer-excel-file-with-header-in-top-rows---rio" class="section level3">
<h3>Democracy Barometer: Excel file with header in top rows <code>-&gt; rio</code></h3>
<p><code>rio::import</code> instead of <code>readxl::read_excel</code>.</p>
<pre class="r"><code>db &lt;- import(&quot;http://www.democracybarometer.org/Data/DB_data_1990-2016_Standardized.xls&quot;, 
             skip = 4) %&gt;%
  mutate(iso3 = countrycode(`Ccode QOG`, &quot;iso3n&quot;, &quot;iso3c&quot;),
         PARTICIP = as.numeric(PARTICIP)) %&gt;%
  select(iso3, year = Year, db_PARTICIP = PARTICIP)</code></pre>
</div>
<div id="the-standardized-world-income-inequality-database-swiid-plain-csv-file---rio" class="section level3">
<h3>The Standardized World Income Inequality Database (SWIID): Plain CSV file <code>-&gt; rio</code></h3>
<p><code>rio::import</code> instead of <code>read.csv</code>, but parameters (such as <code>encoding</code> to deal with country names like São Tomé and Príncipe) stay the same.</p>
<pre class="r"><code>swiid &lt;- import(&quot;https://raw.githubusercontent.com/fsolt/swiid/master/data/swiid7_1_summary.csv&quot;,
                  encoding = &quot;UTF-8&quot;) %&gt;%
  mutate(iso3 = countrycode(country, &quot;country.name&quot;, &quot;iso3c&quot;)) %&gt;%
  mutate(iso3 = ifelse(country == &quot;Kosovo&quot;, &quot;XKX&quot;, iso3)) %&gt;%
  select(iso3, year, gini_disp)</code></pre>
</div>
<div id="world-banks-world-development-indicators-dedicated-package" class="section level3">
<h3>World Bank’s World Development Indicators: Dedicated package</h3>
<p>The same - dedicated packages are still my preferred option.</p>
<pre class="r"><code>poverty &lt;- WDI(country=&quot;all&quot;, indicator=c(&quot;SI.POV.NAHC&quot;),
    start=1900, end=2018, extra=TRUE, cache=NULL) %&gt;%
  filter(!is.na(SI.POV.NAHC)) %&gt;%
  select(iso3 = iso3c, year, wb_poverty = SI.POV.NAHC)</code></pre>
</div>
<div id="merging-all-datasets" class="section level3">
<h3>Merging all datasets</h3>
<pre class="r"><code>merged &lt;- full_join(db, fh) %&gt;%
  full_join(polity) %&gt;%
  full_join(polyarchy) %&gt;%
  full_join(swiid) %&gt;%
  full_join(vdem.part) %&gt;%
  full_join(poverty) %&gt;%
  mutate(country = countrycode(iso3, &quot;iso3c&quot;, &quot;country.name&quot;))</code></pre>
</div>
<div id="writing-to-file" class="section level3">
<h3>Writing to file</h3>
<p>The final dataset can be saved to one of the many types of files supported by <code>rio</code>, just modify the extension.</p>
<pre class="r"><code>export(merged, &quot;merged.csv&quot;)</code></pre>
</div>


  
<div class="prev-next-post pure-g">
  <div class="pure-u-1-24" style="text-align: left;">
    
    <a href="/post/participation-inequality-indices/"><i class="fa fa-chevron-left"></i></a>
    
  </div>
  <div class="pure-u-10-24">
    
    <nav class="prev">
      <a href="/post/participation-inequality-indices/">Downloading country-level indicators on participation and economic inequality</a>
    </nav>
    
  </div>
  <div class="pure-u-2-24">
    &nbsp;
  </div>
  <div class="pure-u-10-24">
    
  </div>
  <div class="pure-u-1-24" style="text-align: right;">
    
  </div>
</div>



  
<div id="disqus_thread"></div>
<script type="text/javascript">

(function() {
    
    
    if (window.location.hostname == "localhost")
        return;

    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    var disqus_shortname = 'https-martakolczynska-netlify-com';
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com/" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>


</div>

</div>
</div>
<script src="/js/ui.js"></script>


<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-123060748-1', 'auto');
  ga('send', 'pageview');

</script>





</body>
</html>

