---
title: "ISA World Congress 2018: Analysis of tweets"
author: "Marta Kołczyńska"
date: 2018-07-23T15:34:00
categories: ["text"]
tags: ["twitter", "text analysis", "ISA", "R", "SICSS"]

---

The [International Sociological Association World Congress 19th Congress of Sociology in Toronto](https://www.isa-sociology.org/en/conferences/world-congress/toronto-2018/) has received quite some Twitter coverage. Waiting to board the flight from Toronto back to Warsaw, I wanted to take a look at these Twitter data and apply the newly acquired skills in text analysis (thanks to the [Summer Institute for Computational Social Science Parter Site (SICSS)](https://compsocialscience.github.io/summer-institute/2018/helsinki/) in Tvärminne and Helsinki, Finland).

A few years ago my colleagues from the Polish Academy of Sciences and I wrote a paper about the inequality in national representation at ISA events (congresses and fora) [^1]. This short analysis reveals a different type of inequality at ISA conferences.

### Setup

First, all the necessary packages:

```{r packages, warning=FALSE, message=FALSE}
library(tidyverse) # data manipulation and cleaning
#devtools::install_github("mkearney/rtweet")
library(rtweet) # get tweets
library(wordcloud) # self explanatory
library(ggplot2) # plots
library(maps) # maps
library(rworldmap) # maps
library(leaflet) # maps
library(tidytext) # tokenize
library(lubridate) # dealing with dates
library(DescTools) # Lorenz curve
library(reldist) # gini index
library(knitr) # knit tables

```

Tweets are an increasingly popular source of data for social scientists, not least because they can be quickly and conveniently obtained through the Twitter API. There are many excellent tutorials about how to connect to Twitter to download tweets. Here is one of them:  
https://compsocialscience.github.io/summer-institute/2018/materials/day2-digital-trace-data/apis/rmarkdown/SICSS_APIs_markdown.html

I downloaded tweets that contained one of the conference hashtags: `#isa2018wcs` or `#isa18wcs`. Twitter downloads typically contain tweets from the last 5-10 days, and the set of tweets can change from download to download. This is why I saved the downloaded tweets in a .csv file for future use. The code for downloading tweets with the ISA 2018 World Congress of Sociology was as follows:

`isa <- search_tweets("#isa2018wcs OR #isa18wcs", since = "2018-06-01", n = 100000, type="recent", include_rts=TRUE)`  
`data.table::fwrite(isa, file = "isa_tweets.csv")`

```{r, echo = FALSE, results="hide"}
setwd("C:/Users/mkolc/Google Drive/Academia/Blog/martakolczynska/drafts/")
```

```{r load, warning=FALSE, message=FALSE, results="hide"}
isa <- read.csv("isa_tweets.csv", stringsAsFactors = FALSE) # open Twitter extract

isa$status_id <- as.character(isa$status_id)

isa$created_at <- as.POSIXct(strptime(isa$created_at, format = "%Y-%m-%dT%H:%M:%S")) # convert string to date and time
isa$created_at <-  with_tz(isa$created_at, 'America/Toronto') # set time zone
```
I requested tweets starting with June 1, 2018, but this is unrealistic, so I will check what's the earliest tweet date. It's July 12, 7:43 am. The last tweet in my collection is from July 22, 7pm.

```{r min max date, warning = FALSE, message = FALSE}
min(isa$created_at)
max(isa$created_at)
```
And here are the texts of a few sample tweets:
```{r head, warning = FALSE, message = FALSE}
head(isa$text)
```


### Tweets over time

I want to see the distribution of ISA 2018 WCS tweets over time: first for the whole period covered by the data extract, then only for the Congress days, and finally on the busiest day - July 18th.


```{r time plots, warning=FALSE, message=FALSE}
ts_plot(isa, "1 hour") +
  labs(x = NULL, y = NULL,
    title = "Frequency of #isa2018wcs OR #isa18wcs tweets since July 12, 2018",
    subtitle = "Twitter counts by hour",
    caption = "Source: Data collected from Twitter's API via rtweet")

isa %>% filter(as.Date(created_at) >= "2018-07-15" & as.Date(created_at) <= "2018-07-21") %>%
  ts_plot(., "1 hour") + 
    labs(x = NULL, y = NULL,
       title = "Frequency of #isa2018wcs OR #isa18wcs tweets July 15-21, 2018",
       subtitle = "Twitter counts by hour",
       caption = "Source: Data collected from Twitter's API via rtweet")

isa %>% filter(as.Date(created_at) >= "2018-07-18" & as.Date(created_at) < "2018-07-19") %>%
  ts_plot(., "5 minutes") + 
    labs(x = NULL, y = NULL,
       title = "Frequency of #isa2018wcs OR #isa18wcs tweets on July 18, 2018",
       subtitle = "Twitter counts by 5 minutes",
       caption = "Source: Data collected from Twitter's API via rtweet")

```


### Location of tweets

Just out of curiosity, I will check the location of original tweets (excluding retweets). Rather unsurprisingly, they are mostly from Canada, but also from the UK and Germany. 

```{r geocoded, warning=FALSE, message=FALSE}

geocoded <- lat_lng(isa[isa$is_retweet == FALSE,])

isamap <- getMap(resolution = "low")
plot(isamap, xlim = c(-130, 130), ylim = c(-50, 90), asp = 1)
points(geocoded$lng, geocoded$lat, pch = 20, col = "red", cex = 2)

isamap <- getMap(resolution = "low")
plot(isamap, xlim = c(-130, 130), ylim = c(-50, 90), asp = 1)
points(geocoded$lng, geocoded$lat, pch = 20, col = "red", cex = 2)

leaflet(geocoded) %>%
  addTiles() %>%
  addMarkers(~lng, ~lat) 

```


### Text analysis
Before the tweets can be analyzed, they need to be tokenized (each word needs to become a separate record = row), and cleaned (stop words and other unnecessary strings need to be eliminated).

```{r text analysis, warning=FALSE, message=FALSE}
data("stop_words")

isa_words <- isa %>%
  unnest_tokens(word, text) %>%
  select(status_id, created_at, word) %>%
  anti_join(stop_words) %>% # eliminate stop words
  filter(!grepl("https|t.co|amp|rt|de|â|isa18wcs|isa2018wcs|isa_sociology|sociology|
                isa|session|toronto|canada|congress|conference", 
              word)) %>% # eliminate unnecessary strings or obvious words
  filter(!grepl("\\b\\d+\\b", word)) # eliminate numbers

isa_words %>%
  count(word) %>%
  arrange(desc(n))
```

### Resesarch committees

Research committees (RC) are the core organizational unit in ISA. Research Committees bring together scholars interested in the same topic, e.g. political sociology or sociology of education. As of now, there are 57 RCs.

I noticed that many tweets have RC hashtags, so I wanted to see which RC got the most tweets and how equal or unequal the distribution of tweets was.

```{r rc, warning=FALSE, message=FALSE}

isa_rc <- isa_words %>% filter(str_detect(tolower(word), "rc[0-9]{2}"))
isa_rc$rc <- str_extract(isa_rc$word, "rc[0-9]{2}")
head(isa_rc, 10)

isa_rc <- isa_rc %>% group_by(status_id, created_at, rc) %>% summarise(count = n())
```

Most tweets mention just one research committee, but some refer to two or more, particularly with reference to joint sessions. Some tweets also refer to the same RC with more than one hashtag, e.g. `#rc34youth` and `#rc34toronto`. These instances need to be collapsed to count as one.

```{r rc 2, warning=FALSE, message=FALSE}
wordcloud(isa_rc$rc, min.freq=1, random.color = TRUE, colors= palette(rainbow(20)))
```

A simple word cloud reveals the unanimous winner in the RC tweet competition: RC34 Sociology of Youth.

```{r rc 3, warning=FALSE, message=FALSE}
ggplot(isa_rc, aes(rc, col = rc)) + geom_bar() +
  theme(axis.text.x = element_text(angle = 90, hjust = 2, vjust = 0.5), legend.position="none") + 
  ylab("Number of tweets by Research Committee") + 
  xlab("") + 
  ggtitle("Tweets by Research Committee") +
  labs(caption = "Source: Data collected from Twitter's API via rtweet")
```

The bar plot confirms this result: RC34 is mentioned in the highest number of tweets and there is quite some variation in the number of tweets across RCs. Let's see how much exactly.

```{r rc 4, warning=FALSE, message=FALSE}

isa_rc_n <- isa_rc %>% group_by(rc) %>% tally() %>% arrange(desc(n))

plot(Lc(isa_rc_n$n, lwd=2))

gini(isa_rc_n$n)
```


```{r top10, warning=FALSE, message=FALSE}
isa_rc %>% group_by(rc) %>% tally() %>% arrange(desc(n)) %>% top_n(10) %>%
  kable(., caption = "Top 10 Research Committees", padding = 2, format = "markdown")

```

According to the data, some of the tweet peaks include:
for RC17 on June 18th around 3pm and on the 19th around 2pm,
for RC22 on June 19th around 8pm,
for RC34 on June 18th around noon (RC34 business meeting) at 11am-noon and on June 19th between 2-5pm.

Overall it looks like the presentations around noon (11.30am - 1.20pm) were most tweet-provoking. Time stamps include hours, minutes and seconds, so it's possible to link tweets to concrete sessions.


[^1]: [Joshua K. Dubrow, Marta Kołczyńska, Irina Tomescu-Dubrow, and Kazimierz M. Slomczynski. 2018. "Sociologists everywhere: Country representation in conferences hosted by the International Sociological Association, 1990–2012". *Current Sociology* 66(3): 466-489.](https://www.academia.edu/14504525/Sociologists_everywhere_Country_representation_in_conferences_hosted_by_the_International_Sociological_Association_1990_2012)


